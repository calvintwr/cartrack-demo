(this.webpackJsonpview=this.webpackJsonpview||[]).push([[0],{12:function(e,t,n){},13:function(e,t,n){},15:function(e,t,n){},16:function(e,t,n){"use strict";n.r(t);var i=n(1),s=n.n(i),r=n(7),a=n.n(r),c=(n(12),n(13),n(2)),o=n(3),l=n(5),u=n(4),h={maxRequest:5,quotaWithin:10},d=n(0),m=function(e){Object(l.a)(n,e);var t=Object(u.a)(n);function n(e){var i;return Object(c.a)(this,n),(i=t.call(this,e)).timerInterval=void 0,i.state={timeLeft:0},i}return Object(o.a)(n,[{key:"componentDidMount",value:function(){var e=this;f(this),this.timerInterval=setInterval((function(){f(e)}),100)}},{key:"componentDidUpdate",value:function(e){var t=this;this.props.timeOfReset!==e.timeOfReset&&(this.timerInterval&&clearInterval(this.timerInterval),this.timerInterval=setInterval((function(){f(t)}),100))}},{key:"componentWillUnmount",value:function(){this.timerInterval&&clearInterval(this.timerInterval)}},{key:"render",value:function(){var e=this.state.timeLeft,t=this.props,n=t.maxQuota,i=t.requestsRemaining;return Object(d.jsxs)("span",{children:[Object(d.jsxs)("p",{children:["Seconds to next reset: ",e]}),Object(d.jsxs)("p",{children:["Requests limit: ",n]}),Object(d.jsxs)("p",{children:["Requests remaining: ",i]})]})}}]),n}(s.a.Component),f=function(e){var t=e.props.timeOfReset?j(e.props.timeOfReset):0;if(t<=0)return e.timerInterval&&clearInterval(e.timerInterval),e.props.reset&&e.props.reset(),void(0!==e.state.timeLeft&&e.setState({timeLeft:0}));e.setState({timeLeft:t})},j=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(new Date).getTime(),n=e-t;return Math.round(n/1e3)},v=m,g=(n(15),function(e){Object(l.a)(n,e);var t=Object(u.a)(n);function n(e){var i;return Object(c.a)(this,n),(i=t.call(this,e)).optionLabels=["Yes","No"],i.handleChange=function(e){var t=e.target.checked;i.setState({checked:t}),i.props.onChange(t)},i.state={checked:e.checked},i}return Object(o.a)(n,[{key:"render",value:function(){var e=this.props,t=e.id,n=e.label,i=this.state.checked;return Object(d.jsxs)("div",{className:"toggle-outer",children:[Object(d.jsxs)("div",{className:"toggle",children:[Object(d.jsx)("input",{type:"checkbox",className:"toggle-checkbox",id:t,checked:i,onChange:this.handleChange}),Object(d.jsxs)("label",{className:"toggle-label",htmlFor:t,children:[Object(d.jsx)("span",{className:"toggle-inner","data-yes":this.optionLabels[0],"data-no":this.optionLabels[1]}),Object(d.jsx)("span",{className:"toggle-switch"})]})]}),Object(d.jsx)("label",{htmlFor:t,children:n})]})}}]),n}(s.a.Component)),b=function(e){Object(l.a)(n,e);var t=Object(u.a)(n);function n(e){var i;return Object(c.a)(this,n),(i=t.call(this,e)).requestButtonText="Make Request",i.clientDuration=h.quotaWithin+.4,i.clientMaxQuota=h.maxRequest,i.makeRequest=function(){if(!(i.state.clientSideLimiter&&i.state.clientRemaining<1)){var e={},t=!1;return i.setState({requestOngoing:!0,requestButtonText:"Requesting..."}),fetch("http://localhost:3000/",{mode:"cors"}).then((function(n){return n.headers.forEach((function(t,n){return e[n]=t})),t=n.ok,n.json()})).then((function(n){if(!t)throw Error(n.message);console.log("%cBody:","color: green"),console.log(n),console.log("%cHeaders","color: blue"),console.log(e),i.setState({totalRequests:i.state.totalRequests+1,serverMaxQuota:e["ratelimit-limit"],serverRemaining:e["ratelimit-remaining"],serverTimeOfReset:p(e["x-ratelimit-reset"],e["ratelimit-reset"])}),i.setState({clientRemaining:i.state.clientRemaining-1}),(!i.state.clientTimeOfReset||(new Date).getTime()>i.state.clientTimeOfReset)&&i.setState({clientTimeOfReset:p(null,i.clientDuration)})})).catch((function(e){alert(e),console.warn(e)})).finally((function(){setTimeout((function(){i.setState({requestOngoing:!1,requestButtonText:i.requestButtonText})}),500)}))}alert("[Client-side limiter] You run out of request quota. Please wait and try again later.")},i.clientSideLimiterChange=function(e){i.setState({clientSideLimiter:e})},i.resetClientQuota=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:i.clientMaxQuota;i.setState({clientRemaining:e})},i.resetServerQuota=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:i.state.serverMaxQuota;i.setState({serverRemaining:e})},i.state={totalRequests:0,serverMaxQuota:0,serverRemaining:0,requestButtonText:i.requestButtonText,clientSideLimiter:!1,clientRemaining:i.clientMaxQuota},i}return Object(o.a)(n,[{key:"componentDidMount",value:function(){this.makeRequest()}},{key:"render",value:function(){var e=this.state,t=e.totalRequests,n=e.serverMaxQuota,i=e.serverRemaining,s=e.serverTimeOfReset,r=e.clientRemaining,a=e.clientTimeOfReset,c=e.clientSideLimiter,o=e.requestOngoing,l=e.requestButtonText,u=this.makeRequest,h=this.clientSideLimiterChange,m=this.clientMaxQuota,f=this.resetClientQuota,j=this.resetServerQuota;return Object(d.jsxs)("div",{children:[Object(d.jsxs)("article",{children:[Object(d.jsx)("h2",{children:"Both server and client should impose rate limiting."}),Object(d.jsx)("p",{children:"Client-side rate limiting blocks excessive requests at the earliest possible opportunity, saving network resources, or cuts unneccessary 3rd party API costs (e.g. Google Map)."}),Object(d.jsx)("p",{children:'Server-side rate limit is the "last line" of defence, and can also mitigate DDoS to a certain extent.'}),Object(d.jsx)("p",{children:"In the example below, you can toggle on and off the client-side rate limiter (server rate limit is always on). The slight difference in countdown between the two timers represents the server lag, or client/server clock differences."})]}),Object(d.jsxs)("h1",{children:["Hello, you've made ",t," request",t>1?"s":""," successfully."]}),Object(d.jsx)("p",{children:"(See console for response body and headers)"}),Object(d.jsx)("button",{disabled:o,onClick:u,children:l}),Object(d.jsx)(g,{id:"clientSideLimiter",checked:c,onChange:h,label:"Use client-side rate limiter"}),c?Object(d.jsxs)("span",{children:[Object(d.jsx)("h2",{children:"Client-side limiter (using client-side defined parameters)"}),Object(d.jsx)(v,{timeOfReset:a,maxQuota:m,requestsRemaining:r,reset:f})]}):Object(d.jsxs)("span",{children:[Object(d.jsx)("h2",{children:"Server-side rate limiter (using RateLimit Headers)"}),Object(d.jsx)(v,{timeOfReset:s,maxQuota:n,requestsRemaining:i,reset:j})]})]})}}]),n}(s.a.Component),p=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:(new Date).getTime();if(e)return 1e3*e;if(!t)throw Error("`duration` must be defined if `xRateLimitReset` is not defined.");return n+1e3*t},x=b;var O=function(){return Object(d.jsx)("div",{className:"App",children:Object(d.jsx)("header",{className:"App-header",children:Object(d.jsx)(x,{})})})},R=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,17)).then((function(t){var n=t.getCLS,i=t.getFID,s=t.getFCP,r=t.getLCP,a=t.getTTFB;n(e),i(e),s(e),r(e),a(e)}))};a.a.render(Object(d.jsx)(s.a.StrictMode,{children:Object(d.jsx)(O,{})}),document.getElementById("root")),R()}},[[16,1,2]]]);
//# sourceMappingURL=main.235b0a1b.chunk.js.map